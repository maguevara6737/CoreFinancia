<!-- appfinancia/templates/admin/consulta_causacion.html -->
{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block title %}Reporte de Causaci√≥n por Per√≠odo{% endblock %}

{% block extrastyle %}
  {{ block.super }}
  <style>
    .consulta-container {
      max-width: 650px;
      margin: 0 auto;
      padding: 20px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .form-row {
      margin-bottom: 18px;
    }
    .form-row label {
      display: block;
      font-weight: bold;
      margin-bottom: 6px;
      color: #333;
    }
    .form-row input[type="date"] {
      width: 100%;
      max-width: 220px;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .radio-group {
      margin-top: 8px;
    }
    .radio-option {
      margin: 6px 0;
    }
    .radio-option input {
      margin-right: 8px;
    }
    .submit-row {
      margin-top: 25px;
      text-align: center;
    }
    .submit-row input.default {
      background: #417690;
      color: white;
      padding: 10px 24px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    .info-box {
      background: #e8f5e9;
      padding: 12px;
      border-radius: 6px;
      margin: 20px 0;
      border-left: 4px solid #4caf50;
      font-size: 0.95em;
    }
    .resultado-box {
      margin-top: 25px;
      padding: 18px;
      background: #f0f8f0;
      border-radius: 6px;
      border-left: 4px solid #2e7d32;
      font-family: monospace;
      line-height: 1.5;
    }
    .errorlist {
      color: #d32f2f;
      margin-top: 5px;
      font-size: 0.9em;
    }
    .messages {
      margin-bottom: 20px;
    }
    .messages li {
      padding: 10px;
      border-radius: 4px;
      background: #e8f5e9;
      color: #2e7d32;
      font-weight: bold;
    }
  </style>
{% endblock %}

{% block content %}
<div class="consulta-container">
  <h1>Generar Reporte de Causaci√≥n por Per√≠odo</h1>
  
  <div class="info-box">
    Selecciona un rango de fechas y el tipo de reporte deseado:
    <ul>
      <li><strong>Solo Totales por pantalla</strong>: muestra resumen r√°pido sin descargar.</li>
      <li><strong>Detalle y Totales a Excel</strong>: descarga archivo CSV con desglose completo.</li>
    </ul>
  </div>

  <form method="post">
    {% csrf_token %}
    
    <div class="form-row">
      {{ form.fecha_inicio.label_tag }}
      {{ form.fecha_inicio }}
      {{ form.fecha_inicio.errors }}
    </div>
    
    <div class="form-row">
      {{ form.fecha_fin.label_tag }}
      {{ form.fecha_fin }}
      {{ form.fecha_fin.errors }}
    </div>

    <div class="form-row">
      {{ form.tipo_reporte.label_tag }}
      <div class="radio-group">
        {% for value, label in form.tipo_reporte.field.choices %}
          <div class="radio-option">
            <label>
              <input type="radio" name="{{ form.tipo_reporte.name }}" value="{{ value }}"
                {% if form.tipo_reporte.value == value or value == 'pantalla' %}checked{% endif %}>
              {{ label }}
            </label>
          </div>
        {% endfor %}
      </div>
      {{ form.tipo_reporte.errors }}
    </div>
    
    <div class="submit-row">
      <input type="submit" value="Generar Reporte" class="default" name="_save">
    </div>
  </form>

{% if resultado_pantalla %}
  <div class="resultado-box">
    <h3>üìä Resultado de la consulta</h3>
    <p><strong>Per√≠odo:</strong> {{ resultado_pantalla.fecha_inicio|date:"Y-m-d" }} a {{ resultado_pantalla.fecha_fin|date:"Y-m-d" }}</p>
    <p><strong>Pr√©stamos procesados:</strong> {{ resultado_pantalla.num_prestamos }}</p>
    <p><strong>Total inter√©s causado:</strong> ${{ resultado_pantalla.total_intereses }}</p>
    <p><strong>Total ajustes (AJUINT):</strong> ${{ resultado_pantalla.total_ajustes }}</p>
  </div>
{% endif %}
</div>
{% endblock %}